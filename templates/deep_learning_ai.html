<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Dynamic title for the browser tab -->
    <title>{{ current_video.title if current_video else course_data.course_title }} - Under The Mango Tree</title>
    
    <!-- External Libraries (Bootstrap & Font Awesome) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <!-- Custom Styles (for consistency across all course pages) -->
    <style>
        body { background-color: #f8f9fa; }
        .main-content { display: flex; flex-direction: column; gap: 1.5rem; }
        @media (min-width: 992px) { .main-content { flex-direction: row; } }
        .sidebar { flex: 0 0 100%; }
        @media (min-width: 992px) { .sidebar { flex: 0 0 340px; position: sticky; top: 1rem; align-self: flex-start; max-height: calc(100vh - 2rem); overflow-y: auto; } }
        .video-content-area { flex: 1; }
        .accordion-button:not(.collapsed) { color: #0c63e4; background-color: #e7f1ff; }
        .accordion-button:focus { box-shadow: none; }
        .video-link-list-group a { padding-left: 2.25rem; border: none; font-size: 0.95rem; }
        .video-link-list-group a.active { background-color: #0d6efd; color: white; font-weight: 500; }
        .video-iframe-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 0.375rem; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .video-iframe-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        .content-card .card-header { font-weight: 500; }
        .content-card ul { padding-left: 0; list-style: none; }
        .content-card li { display: flex; align-items: flex-start; padding: 0.5rem 0; }
        .content-card i.fa-check-circle { color: #198754; }
        .content-card i { margin-right: 0.75rem; margin-top: 0.25rem; color: #6c757d; }
    </style>
</head>
<body>
    {% include 'header.html' %}

    <main class="container py-4">
        <div class="main-content">
            
            <!-- Sidebar with Accordion Menu -->
            <aside class="sidebar">
                <div class="p-3 bg-white rounded shadow-sm">
                    <h4 class="mb-3">{{ course_data.course_title }}</h4>
                    <div class="accordion" id="sidebarAccordion">
                        {% for topic in course_data.topics %}
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="heading-ml-{{ loop.index }}">
                                <button class="accordion-button {% if topic.name != current_topic_name %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-ml-{{ loop.index }}" aria-expanded="{% if topic.name == current_topic_name %}true{% else %}false{% endif %}">
                                    <b>{{ topic.name }}</b>
                                </button>
                            </h2>
                            <div id="collapse-ml-{{ loop.index }}" class="accordion-collapse collapse {% if topic.name == current_topic_name %}show{% endif %}">
                                <div class="list-group list-group-flush video-link-list-group">
                                    {% for video in topic.videos %}
                                    <!-- This link correctly points to the 'machine_learning' endpoint -->
                                    <a href="{{ url_for('machine_learning', video_id=video.id) }}" class="list-group-item list-group-item-action {% if current_video and video.id == current_video.id %}active{% endif %}">
                                        {{ video.title }}
                                    </a>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </aside>

            <!-- Main Video and Content Area -->
            <div class="video-content-area">
                {% if current_video %}
                    <h2 class="mb-3">{{ current_video.title }}</h2>

                    <div class="video-iframe-container mb-4">
                        {% set youtube_id = current_video.youtube_url.split('v=')[-1].split('&')[0] %}
                        <iframe src="https://www.youtube.com/embed/{{ youtube_id }}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>

                    <div class="card mb-4 content-card">
                        <div class="card-header bg-primary text-white"><i class="fas fa-graduation-cap me-2"></i>What You Will Learn</div>
                        <div class="card-body">
                            <ul>
                                {% for point in current_video.what_you_will_learn %}
                                <li><i class="fas fa-check-circle"></i><span>{{ point }}</span></li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>

                    <div class="card mb-4 content-card">
                        <div class="card-header bg-info text-white"><i class="fas fa-file-alt me-2"></i>Content Covered</div>
                        <div class="card-body"><p>{{ current_video.content_covered }}</p></div>
                    </div>

                    <div class="card content-card">
                        <div class="card-header bg-secondary text-white"><i class="fas fa-tools me-2"></i>Resources</div>
                        <ul class="list-group list-group-flush">
                            {% for resource in current_video.resources %}
                            <li class="list-group-item">
                                <i class="{{ resource.icon }}"></i>
                                <a href="{{ resource.url }}" target="_blank" class="text-decoration-none">{{ resource.name }}</a>
                            </li>
                            {% else %}
                            <li class="list-group-item text-muted">No additional resources for this video.</li>
                            {% endfor %}
                        </ul>
                    </div>

                {% else %}
                    <div class="alert alert-info text-center">
                        Please select a lesson from the sidebar to begin your learning journey.
                    </div>
                {% endif %}
            </div>
        </div>
    </main>

    {% include 'footer.html' %}
    
    <!-- Bootstrap JS for Accordion Functionality -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
