{% extends "job_portal/base.html" %}

{# Corrected: Removed '>' after title block tag #}
{% block title %}{{ candidate.get('full_name', candidate.get('email', 'Candidate')) }} - Review Candidate{% endblock %}

{% block content %}
<style>
    /* --- Custom Styles for Candidate Review Page (Consistent with Dashboard/Profile/Admin) --- */

    /* Set a light background color for the page content */
    body {
        background-color: #f8f9fa; /* A light grey color, typical for dashboards */
    }

    /* Add subtle shadow and a green border to cards, plus transition for hover effect */
    .card {
        box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1); /* Subtle initial shadow */
        border: 1px solid var(--custom-green); /* Added a subtle green border */
        border-radius: 0.5rem; /* Slightly more rounded corners */
        transition: all 0.3s ease-in-out; /* Smooth transition for transform, shadow, and border color */
    }

    /* Card Hover Effect - Consistent but can be overridden per page if needed */
    /* Default hover: slight lift and a bit more shadow */
    .card:hover {
        transform: translateY(-3px); /* Slight lift */
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15); /* Slightly stronger shadow on hover */
        /* border-color: var(--custom-green-dark); */ /* Optional: Darken border on hover */
        /* cursor: pointer; Use pointer cursor only if the whole card is a link/button */
    }

    /* Disable hover transform/shadow for cards containing forms or specific interactive elements */
    .card:has(form):hover, /* Cards with forms */
    .card:has(.gap-2):hover, /* Cards with button groups */
     .card:has(.rating-input):hover, /* Card with rating input */
     .card:has(.progress):hover, /* Card with progress bar */
     .card:has(.d-flex.justify-content-between.align-items-center.mb-3):hover /* Cards with document list */
     {
         transform: none !important; /* Disable card lift */
         box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1) !important; /* Revert to original shadow */
     }


    /* Ensure interactive elements within the card are clickable */
     .card a.btn, .card button.btn {
         position: relative; /* Ensure button is above the card potentially */
         z-index: 2; /* Give it a higher z-index */
     }


    /* Custom green color for elements (adjust shade as needed) */
    :root {
        --custom-green: #28a745; /* A standard Bootstrap success green */
        --custom-green-dark: #218838;
    }

    /* Page Title Icon color */
    h1 i.fas {
        color: var(--custom-green);
    }

    /* Card Header Icon color */
    .card-header h5 i.fas, .card-header h6 i.fas {
        color: var(--custom-green); /* Default header icons to green */
    }


    /* Custom Green Button Style (Primary action) */
    .btn-custom-green {
        background-color: var(--custom-green);
        color: white;
        border-color: var(--custom-green);
        /* Add transition for smooth color/shadow change on hover */
        transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    .btn-custom-green:hover { background-color: var(--custom-green-dark); border-color: var(--custom-green-dark); color: white; }
    .btn-custom-green:focus { box-shadow: 0 0 0 0.25rem rgba(40, 167, 69, 0.25); }
    .btn-custom-green:disabled { background-color: var(--custom-green); border-color: var(--custom-green); opacity: 0.65; }


     /* Secondary Button Style */
    .btn-secondary, .btn-outline-secondary {
        /* Using default Bootstrap secondary styles, but add transition */
         transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out, color 0.2s ease-in-out;
    }

     /* Danger Button Style */
     .btn-danger, .btn-outline-danger {
         /* Using default Bootstrap danger styles, add transition */
         transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out, color 0.2s ease-in-out;
     }

     /* Info/Primary Button Style for specific cases (e.g., tags in modals) */
     /* Changed outline-primary in documents to outline-secondary */
     .btn-info, .btn-outline-info, .btn-primary, .btn-outline-primary {
          /* Using default Bootstrap styles, add transition */
          transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out, color 0.2s ease-in-out;
     }


    /* Badge Colors (using standard Bootstrap bg- classes, consistent) */
    .badge.bg-primary { background-color: #0d6efd !important; color: #fff !important;} /* Keep primary blue for some tags */
    .badge.bg-info { background-color: #17a2b8 !important; color: #fff !important;} /* Info/Cyan for some tags */
    .badge.bg-warning { background-color: #ffc107 !important; color: #212529 !important; } /* Yellow */
    .badge.bg-success { background-color: var(--custom-green) !important; color: #fff !important;} /* Green */
    .badge.bg-danger { background-color: #dc3545 !important; color: #fff !important;} /* Red */
    .badge.bg-secondary { background-color: #6c757d !important; color: #fff !important;} /* Grey */
     .badge.bg-light { background-color: #f8f9fa !important; color: #212529 !important;} /* Light badge */


    /* Icon Colors */
    /* Icons in card bodies, default color often handled by Bootstrap text utilities or specific rules below */
    .card-body i.fas, .card-body i.fab {
        /* Keep default color or Bootstrap utility color if set, or handle specific ones */
    }

    /* Specific Icon Colors */
    .card-body i.fa-star.text-warning { color: #ffc107 !important; } /* Rating stars (warning) */
    .card-body i.fa-star.text-muted { color: #6c757d !important; } /* Rating stars (muted) */
    .card-body i.fa-phone { color: #6c757d !important; } /* Phone icon (muted) */
    .card-body i.fa-linkedin { color: #0a66c2 !important; } /* LinkedIn icon (brand color) */
    .card-body i.fa-github { color: #6c757d !important; } /* GitHub icon (muted) */
    .card-body i.fa-file-pdf { color: var(--custom-green) !important; } /* CV icon (green if available) */
    .card-body i.fa-id-card { color: var(--custom-green) !important; } /* ID card icon (green if available) */
    .card-body i.fa-certificate { color: var(--custom-green) !important; } /* Marksheet icon (green if available) */
     .card-body i.fa-info-circle { color: #17a2b8 !important; } /* Info icon (cyan/info) */
     .card-body i.fa-lightbulb { color: #ffc107 !important; } /* Lightbulb icon (warning) */
     .card-body i.fa-exclamation-triangle { color: #dc3545 !important; } /* Warning icon (danger) */
     .card-body i.fa-briefcase { color: var(--custom-green) !important; } /* Job/briefcase icon */
     .card-body i.fa-users { color: var(--custom-green) !important; } /* Users icon */
     .card-body i.fa-clock { color: #dc3545 !important; } /* Clock icon (danger) */
     .card-body i.fa-chart-bar { color: #ffc107 !important; } /* Analytics chart (warning) */
     .card-body i.fa-plus { color: var(--custom-green) !important; } /* Plus icon */
     .card-body i.fa-cog { color: var(--custom-green) !important; } /* Cog icon */
    .card-body i.fa-map-marker-alt { color: #6c757d !important; } /* Location icon (muted) */
    .card-body i.fa-download { color: #6c757d !important; } /* Download icon (muted) */
    .card-body i.fa-eye { color: #6c757d !important; } /* View icon (muted) */
    .card-body i.fa-edit { color: #6c757d !important; } /* Edit icon (muted) */
    .card-body i.fa-trash { color: #dc3545 !important; } /* Trash icon (danger) */
     /* Whatsapp icon color */
     .card-body i.fab.fa-whatsapp.text-success {
         color: var(--custom-green) !important; /* Make WhatsApp icon green */
     }


     /* Adjust text color for consistency */
     .lead.text-muted, .card-text, .text-muted, .small, table .text-muted {
         color: #6c757d !important; /* Consistent muted text color */
     }
     /* Specific adjustments for form labels in card body */
     .card-body .form-label {
         color: #6c757d !important; /* Ensure form labels are muted */
         font-weight: normal; /* Reduce label weight slightly */
     }
      /* Ensure content next to labels is not muted */
     .card-body .form-label + div,
     .card-body label + .p-3.form-control,
     .card-body label + .small {
         color: #212529; /* Darker text for the actual data/content */
         font-weight: bold; /* Make content bold */
     }
      /* Adjust bolding for specific elements if needed */
     .card-body strong {
         color: #212529; /* Explicitly bold for labels */
     }
      /* Reset bolding for feedback/summary boxes */
     .card-body .p-3.form-control strong {
         font-weight: normal;
         color: inherit;
     }


     /* Stats Card Numbers Color (Not applicable on this page, but included for consistency) */
     .card-body h4.text-primary { color: #0d6efd !important; }
     .card-body h4.text-success { color: var(--custom-green-dark) !important; }
     .card-body h4.text-warning { color: #ffc107 !important; }
     .card-body h4.text-info { color: #17a2b8 !important; }


    /* Style for form control focus color */
    .form-control:focus, .form-select:focus, textarea.form-control:focus {
        border-color: rgba(40, 167, 69, 0.5); /* Green border on focus */
        box-shadow: 0 0 0 0.25rem rgba(40, 167, 69, 0.25); /* Green shadow on focus */
     }

     /* Style for required asterisks on labels */
    label .text-danger {
        font-weight: bold;
        margin-left: 2px; /* Add small space after label */
    }

    /* Style for active tab button on Add/Edit Job (Not applicable here) */
     /* .nav-tabs ... */


    /* Table Styling (Not applicable here) */
    /* .table-dark ... */


    /* Modal Styling (Not applicable here) */
    /* .modal-content ... */


    /* Style for the "No ... Yet" icon */
    .display-1.text-muted i.fas {
        color: #ced4da !important;
     }

    /* --- Specific Styles for Candidate Review Page --- */

    /* Style for the custom star rating input */
    .rating-input { display: flex; gap: 0.25rem; align-items: center; margin-bottom: 0 !important; padding: 0;}
    .rating-input input[type="radio"] { display: none; }
    .rating-star { cursor: pointer; font-size: 1.25rem; color: #ced4da; transition: color 0.2s ease-in-out; }
    /* Style for selected stars */
    .rating-input input[type="radio"]:checked ~ .rating-star i.fas,
    .rating-input .rating-star:hover i.fas,
    .rating-input .rating-star:hover ~ .rating-star i.fas { color: #ffc107 !important; } /* Warning yellow */
    /* Ensure previously selected stars stay highlighted */
    .rating-input input[type="radio"]:checked + .rating-star i.fas { color: #ffc107 !important; }
    /* Stars after the selected one revert to grey */
    .rating-input input[type="radio"]:checked + .rating-star ~ .rating-star i.fas { color: #ced4da !important; }
    /* Fix for the text-warning/text-muted classes overriding custom star color */
    .rating-input .rating-star i.fas.text-warning,
    .rating-input .rating-star i.fas.text-muted { color: inherit !important; }


    /* Admin Feedback/Summary/Interests Display Box */
    .p-3.form-control.border.rounded { /* Re-using form-control classes for styling text boxes */
         background-color: #f8f9fa; /* Match page background */
         border-color: #dee2e6 !important; /* Subtle border */
         color: #495057 !important; /* Readable text */
          max-height: 150px; /* Set max height */
          overflow-y: auto; /* Add scrollbar if needed */
         font-weight: normal !important; /* Don't bold the content here */
         font-size: 1em; /* Standard font size */
         line-height: 1.6; /* Slightly increased line height for readability */
         word-wrap: break-word; /* Break long words */
         white-space: pre-wrap; /* Preserve line breaks */
     }
    /* Specific max height for Interests if needed */
    .p-3.form-control.border.rounded:has(.badge) {
         max-height: 100px; /* Shorter max height for tags */
     }


    /* Profile Completeness Progress Bar */
    .progress {
        height: 20px; /* Keep height */
        border-radius: 0.25rem; /* Match general rounded corners */
         background-color: #e9ecef; /* Light grey background */
         border: 1px solid #ced4da; /* Add a subtle border */
    }
    .progress-bar {
         background-color: var(--custom-green); /* Green progress bar */
        color: white; /* White text */
        font-weight: bold; /* Bold text */
         text-align: center; /* Center the text */
         transition: width 0.6s ease; /* Smooth animation */
    }
     /* Style for completeness text below progress bar */
     .small.text-muted.text-center {
         margin-top: 0.5rem; /* Add margin above text */
     }

</style>

<div class="container py-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                     {# Icon color controlled by CSS #}
                    <h1 class="mb-0"><i class="fas fa-user me-2"></i>{{ candidate.get('full_name', candidate.get('email', 'Candidate Details')) }}</h1> {# Changed icon to user #}
                    <p class="lead text-muted">Candidate Review & Details</p> {# text-muted styled #}
                </div>
                {# Changed button to outline-secondary #}
                <a href="{{ url_for('admin_routes.review_candidates') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i>Back to List
                </a>
            </div>
             <hr class="mb-4"> {# Add a horizontal rule for consistency #}
        </div>
    </div>

    <div class="row">
        <!-- Candidate Information (Left Column) -->
        <div class="col-lg-8">
            <!-- Personal Information -->
            <div class="card mb-4"> {# Card style applied #}
                <div class="card-header bg-light"><h5 class="mb-0"><i class="fas fa-user me-2"></i>Personal Information</h5></div> {# Icon color controlled by CSS, light background #}
                <div class="card-body">
                     <div class="row">
                         <div class="col-md-6 mb-3">
                             <label class="form-label text-muted">Full Name</label> {# text-muted styled #}
                             <div>{{ candidate.get('full_name', 'Not provided') }}</div> {# Content next to label is styled #}
                         </div>
                         <div class="col-md-6 mb-3">
                             <label class="form-label text-muted">Email</label> {# text-muted styled #}
                             <div>{{ candidate.get('email') }}</div> {# Content next to label is styled #}
                         </div>
                     </div>
                     <div class="row">
                         <div class="col-md-6 mb-3">
                            <label class="form-label text-muted">WhatsApp Number</label> {# text-muted styled #}
                            <div> {# Content next to label is styled #}
                                {% if candidate.get('phone') %}
                                     {# WhatsApp icon color controlled by CSS #}
                                    <i class="fab fa-whatsapp me-2 text-success"></i>{{ candidate.get('phone') }}
                                    {% set whatsapp_number_cleaned = candidate.get('phone')|replace('+', '')|replace(' ', '')|replace('-', '') %}
                                    {% if whatsapp_number_cleaned.startswith('0') and whatsapp_number_cleaned|length == 11 %}
                                        {% set whatsapp_number_cleaned = '91' + whatsapp_number_cleaned[1:] %}
                                    {% elif not whatsapp_number_cleaned.startswith('91') and whatsapp_number_cleaned|length == 10 %}
                                        {% set whatsapp_number_cleaned = '91' + whatsapp_number_cleaned %}
                                    {% endif %}
                                    {% if whatsapp_number_cleaned.startswith('91') and whatsapp_number_cleaned|length == 12 %}
                                         {# WhatsApp chat link styled as badge #}
                                        <a href="https://wa.me/{{ whatsapp_number_cleaned }}" target="_blank"
                                           class="ms-2 badge bg-success text-white text-decoration-none"
                                           title="Chat on WhatsApp">
                                            Chat <i class="fas fa-comment-dots ms-1"></i>
                                        </a>
                                    {% endif %}
                                {% else %}
                                    <span class="text-muted">Not provided</span> {# text-muted styled #}
                                {% endif %}
                            </div>
                        </div>
                         <div class="col-md-6 mb-3">
                             <label class="form-label text-muted">Registration Date</label> {# text-muted styled #}
                             <div> {# Content next to label is styled #}
                                  {# Calendar icon color controlled by CSS #}
                                 <i class="fas fa-calendar me-2 text-muted"></i>{% if candidate.get('created_at') %}{{ candidate.get('created_at').strftime('%B %d, %Y') }}{% else %}N/A{% endif %}
                            </div>
                         </div>
                     </div>
                     <div class="row">
                         {% if candidate.get('linkedin') %}
                             <div class="col-md-6 mb-3">
                                 <label class="form-label text-muted">LinkedIn</label> {# text-muted styled #}
                                 <div> {# Content next to label is styled #}
                                     {# LinkedIn icon color controlled by CSS #}
                                     <a href="{{ candidate.get('linkedin') }}" target="_blank" class="text-decoration-none text-muted"><i class="fab fa-linkedin me-2"></i>View Profile</a> {# text-muted on link #}
                                </div>
                             </div>
                         {% endif %}
                         {% if candidate.get('github') %}
                             <div class="col-md-6 mb-3">
                                 <label class="form-label text-muted">GitHub</label> {# text-muted styled #}
                                 <div> {# Content next to label is styled #}
                                     {# GitHub icon color controlled by CSS #}
                                     <a href="{{ candidate.get('github') }}" target="_blank" class="text-decoration-none text-muted"><i class="fab fa-github me-2"></i>View Profile</a> {# text-muted on link #}
                                </div>
                             </div>
                         {% endif %}
                     </div>
                </div>
            </div>

            <!-- Education Details -->
            <div class="card mb-4"> {# Card style applied #}
                <div class="card-header bg-light"><h5 class="mb-0"><i class="fas fa-graduation-cap me-2"></i>Bachelor Education</h5></div> {# Icon color controlled by CSS, light background #}
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <label class="form-label text-muted">College/University:</label> {# text-muted styled #}
                            <div>{{ candidate.get('college_name') or 'Not provided' }}</div> {# Content next to label is styled #}
                        </div>
                        <div class="col-md-6 mb-2"> {# Corrected col-md-6 #}
                            <label class="form-label text-muted">Degree:</label> {# text-muted styled #}
                            <div>{{ candidate.get('degree') or 'Not provided' }}</div> {# Content next to label is styled #}
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <label class="form-label text-muted">Graduation Year:</label> {# text-muted styled #}
                            <div>{{ candidate.get('graduation_year') or 'Not provided' }}</div> {# Content next to label is styled #}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Professional Profile -->
            <div class="card mb-4"> {# Card style applied #}
                <div class="card-header d-flex justify-content-between align-items-center bg-light"> {# light background #}
                     {# Icon color controlled by CSS #}
                    <h5 class="mb-0"><i class="fas fa-briefcase me-2"></i>Professional Profile</h5>
                    {% if candidate.get('profile_status') %}
                         {# Badges styled #}
                        <span class="badge
                            {% if 'Open to Work' in candidate.get('profile_status') %}bg-success
                            {% elif 'Employed' in candidate.get('profile_status') %}bg-primary
                            {% elif 'Internship' in candidate.get('profile_status') %}bg-info
                            {% else %}bg-secondary{% endif %}">
                            <i class="fas fa-info-circle me-1"></i> Status: {{ candidate.get('profile_status') }} {# Info icon color controlled by CSS #}
                        </span>
                    {% endif %}
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label text-muted">Summary of Skills and Strengths:</label> {# text-muted styled #}
                         {# Styled scrollable text box. Applying '-' to strip whitespace around the content #}
                        <div class="p-3 form-control border rounded">
                            {%- if candidate.get('summary') -%}
                                {{ candidate.get('summary')|replace('\n', '<br>')|safe }}
                            {%- else -%}
                                <span class="text-muted">Not provided</span> {# text-muted styled #}
                            {%- endif -%}
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label text-muted">Core Interest Domains:</label> {# text-muted styled #}
                         {# Styled scrollable text box. Applying '-' to strip whitespace around the content #}
                        <div class="p-3 form-control border rounded">
                            {%- if candidate.get('core_interest_domains') -%}
                                {%- for interest in candidate.get('core_interest_domains', '').split(',') -%}
                                    {%- if interest.strip() -%}
                                         {# Badges styled #}
                                        <span class="badge bg-primary me-2 mb-2">{{ interest.strip() }}</span>
                                    {%- endif -%}
                                {%- endfor -%}
                            {%- else -%}
                                <span class="text-muted">Not specified</span> {# text-muted styled #}
                            {%- endif -%}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Additional Information -->
             <div class="card mb-4"> {# Card style applied #}
                 <div class="card-header bg-light"><h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Additional Information</h5></div> {# Icon color controlled by CSS, light background #}
                 <div class="card-body">
                     <div class="row">
                         <div class="col-md-6 mb-2"><label class="form-label text-muted">12th School Type:</label> <div>{{ candidate.get('twelfth_school_type') | title or 'Not provided' }}</div></div> {# text-muted styled, content styled #}
                         <div class="col-md-6 mb-2"><label class="form-label text-muted">Parental Annual Income:</label> <div>{{ candidate.get('parental_annual_income') or 'Not provided' }}</div></div> {# text-muted styled, content styled #}
                     </div>
                 </div>
             </div>

            <!-- Admin Review & Actions Form -->
            <div class="card"> {# Card style applied #}
                <div class="card-header bg-light"><h5 class="mb-0"><i class="fas fa-edit me-2"></i>Admin Review & Actions</h5></div> {# Icon color controlled by CSS, light background #}
                <div class="card-body">
                    <form method="POST" action="{{ url_for('admin_routes.rate_candidate', candidate_id=candidate.id) }}">
                        <div class="mb-3">
                            <label class="form-label text-muted">Rating (1-5 Stars)</label> {# text-muted styled #}
                            <div class="rating-input"> {# Custom rating input styled by CSS #}
                                {% for i in range(1, 6) %}
                                    <input type="radio" id="rating{{ i }}" name="rating" value="{{ i }}" {{ 'checked' if candidate.get('rating') == i else '' }}>
                                     {# Star icon color handled by custom JS/CSS #}
                                    <label for="rating{{ i }}" class="rating-star"><i class="fas fa-star"></i></label>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="feedback" class="form-label text-muted">Feedback</label> {# text-muted styled #}
                             {# textarea focus styled #}
                            <textarea class="form-control" id="feedback" name="feedback" rows="3" placeholder="Provide feedback or internal notes...">{{ candidate.get('admin_feedback', '') }}</textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label text-muted">Job/Skill Tags</label> {# text-muted styled #}
                            <div>
                                {% for tag_option in available_admin_skill_tags %}
                                <div class="form-check form-check-inline">
                                     {# form-check-input focus styled #}
                                    <input class="form-check-input" type="checkbox" name="admin_tags" id="tag_{{ loop.index }}" value="{{ tag_option }}" {{ 'checked' if tag_option in selected_admin_tags else '' }}>
                                    <label class="form-check-label text-muted" for="tag_{{ loop.index }}">{{ tag_option }}</label> {# text-muted styled #}
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="mb-4">
                            <div class="form-check">
                                 {# form-check-input focus styled #}
                                <input class="form-check-input" type="checkbox" name="is_certified" id="is_certified" {{ 'checked' if candidate.get('is_certified') else '' }}>
                                <label class="form-check-label text-muted" for="is_certified">Mark as Certified</label> {# text-muted styled #}
                            </div>
                            <small class="text-muted">Disclaimer: Certification by admin indicates a basic profile review and does not guarantee employment or skill proficiency.</small> {# text-muted styled #}
                        </div>
                        {# Changed button to custom green #}
                        <button type="submit" class="btn btn-custom-green"><i class="fas fa-save me-2"></i>Submit Review</button>
                    </form>
                </div>
            </div>
        </div>

               <!-- Sidebar (Right Column) -->
        <div class="col-lg-4">
            <!-- Current Admin Review (Display only) -->
            {% if candidate.get('rating') is not none or candidate.get('admin_feedback') or candidate.get('admin_tags') or candidate.get('is_certified') %} {# Check for not none - Removed duplicate IF here #}
                <div class="card mb-4"> {# Card style applied #}
                    <div class="card-header bg-light"><h6 class="mb-0"><i class="fas fa-clipboard-check me-2"></i>Current Admin Review</h6></div> {# Icon color controlled by CSS, light background #}
                    <div class="card-body">
                         {# text-muted styled, content styled, icon colors controlled by CSS #}
                        {% if candidate.get('rating') is not none %}<div class="mb-2"><label class="form-label text-muted small">Rating:</label><div>{% for i in range(1, 6) %}<i class="fas fa-star {{ 'text-warning' if i <= candidate.get('rating') else 'text-muted' }}"></i>{% endfor %} <span class="ms-2 fw-bold">{{ candidate.get('rating') }}/5</span></div></div>{% endif %}
                         {# text-muted styled, content styled, badges styled. CORRECTED ADMIN TAGS LOOP #}
                         {# Corrected typo %{% to }{% #}
                        {% if candidate.get('admin_tags') %}<div class="mb-2"><label class="form-label text-muted small">Tags:</label><div>{% for tag in candidate.get('admin_tags', '').split(',') %}{% if tag.strip() %}<span class="badge bg-info me-1 mb-1 fw-normal">{{ tag.strip() }}</span>{% endif %}{% endfor %}</div></div>{% endif %}
                         {# text-muted styled, content styled, badge styled, icon color controlled by CSS #}
                        {% if candidate.get('is_certified') %}<div class="mb-2"><label class="form-label text-muted small">Certification:</label><div><span class="badge bg-success"><i class="fas fa-check-circle me-1"></i>Admin Certified</span></div></div>{% endif %}
                         {# text-muted styled, content styled (styled box) #}
                         {# Applying '-' to strip whitespace around the content #}
                        {%- if candidate.get('admin_feedback') -%}
                            <div>
                                <label class="form-label text-muted small">Feedback:</label>
                                <div class="small p-2 form-control border rounded">{{ candidate.get('admin_feedback') }}</div>
                            </div>
                        {%- endif -%} {# Re-using form-control styling #}
                         {# text-muted styled #}
                         {% if candidate.get('rating') is none and candidate.get('admin_feedback') is none and candidate.get('admin_tags') is none and not candidate.get('is_certified') %}
                            <p class="text-muted">Not yet reviewed by admin.</p>
                         {% endif %}
                    </div>
                </div>
            {% endif %}

            <!-- Candidate Documents -->
            <div class="card mb-4"> {# Card style applied #}
                <div class="card-header bg-light"><h6 class="mb-0"><i class="fas fa-file-alt me-2"></i>Candidate Documents (PDF Only)</h6></div> {# Icon color controlled by CSS, light background #}
                <div class="card-body">
                    {% set doc_types = [
                        {'type': 'cv', 'name': 'CV/Resume', 'icon': 'fa-file-pdf', 'filename_attr': 'cv_filename'},
                        {'type': 'id_card', 'name': 'ID Card', 'icon': 'fa-id-card', 'filename_attr': 'id_card_filename'},
                        {'type': 'marksheet', 'name': '12th Marksheet', 'icon': 'fa-certificate', 'filename_attr': 'marksheet_filename'},
                        {'type': 'ews_certificate', 'name': 'EWS Certificate', 'icon': 'fa-file-invoice', 'filename_attr': 'ews_certificate_filename'}
                    ] %}
                    {% for doc_item in doc_types %}
                        <div class="d-flex justify-content-between align-items-center mb-3">
                             {# Icon color controlled by CSS #}
                            <div><i class="fas {{ doc_item.icon }} me-2"></i><span class="fw-bold">{{ doc_item.name }}</span></div>
                           {% if candidate.get(doc_item.filename_attr) %}
                                {# Changed button to outline-secondary #}
                                <a href="{{ candidate.get(doc_item.filename_attr) }}" target="_blank" class="btn btn-outline-secondary btn-sm">
                                    <i class="fas fa-eye me-1"></i> View {# Icon color controlled by CSS #}
                                </a>
                            {% else %}
                                 {# Badge bg-secondary styled #}
                                <span class="badge bg-secondary">Not uploaded</span>
                            {% endif %}
                        </div>
                         {% if not loop.last %}<hr>{% endif %} {# Add separators between documents #}
                    {% endfor %}
                </div>
            </div>
            <!-- Profile Completeness -->
            <div class="card"> {# Card style applied #}
                <div class="card-header bg-light"><h6 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Profile Completeness</h6></div> {# Icon color controlled by CSS, light background #}
                <div class="card-body">
                    {% set completeness_score = 0 %}
                    {% if candidate.get('full_name') %}{% set completeness_score = completeness_score + 10 %}{% endif %}
                    {% if candidate.get('phone') %}{% set completeness_score = completeness_score + 5 %}{% endif %}
                    {% if candidate.get('linkedin') %}{% set completeness_score = completeness_score + 5 %}{% endif %}
                    {% if candidate.get('summary') %}{% set completeness_score = completeness_score + 15 %}{% endif %}
                    {# Corrected typo %{% to }{% #}
                    {% if candidate.get('college_name') and candidate.get('degree') and candidate.get('graduation_year') %}{% set completeness_score = completeness_score + 15 %}{% endif %}
                    {% if candidate.get('core_interest_domains') %}{% set completeness_score = completeness_score + 15 %}{% endif %}
                    {% if candidate.get('cv_filename') %}{% set completeness_score = completeness_score + 10 %}{% endif %}
                    {% if candidate.get('id_card_filename') %}{% set completeness_score = completeness_score + 5 %}{% endif %}
                    {% if candidate.get('marksheet_filename') %}{% set completeness_score = completeness_score + 5 %}{% endif %}
                    {% if candidate.get('ews_certificate_filename') %}{% set completeness_score = completeness_score + 5 %}{% endif %}
                    {% if candidate.get('twelfth_school_type') %}{% set completeness_score = completeness_score + 2.5 %}{% endif %}
                    {% if candidate.get('parental_annual_income') %}{% set completeness_score = completeness_score + 2.5 %}{% endif %}

                    {% if completeness_score > 100 %}{% set completeness_score = 100 %}{% endif %}

                     {# Progress bar styled by CSS #}
                    <div class="progress mb-2" style="height: 20px;">
                        <div class="progress-bar" role="progressbar" style="width: {{ completeness_score }}%" aria-valuenow="{{ completeness_score }}" aria-valuemin="0" aria-valuemax="100">{{ completeness_score|int }}%</div>
                    </div>
                    <div class="small text-muted text-center"> {# text-muted and small styled #}
                        {% if completeness_score >= 80 %}Excellent{% elif completeness_score >= 60 %}Good{% elif completeness_score >= 40 %}Fair{% else %}Needs Improvement{% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div> {# Closes the main row containing left and right columns #}
</div> {# Closes the main container div #}

{# Closes the block 'content' #}
{% endblock %}


{# Opens block 'scripts' #}
{% block scripts %}
{{ super() }}
{# Keep the custom JavaScript for the star rating here #}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ratingContainer = document.querySelector('.rating-input');
    if (ratingContainer) {
        const stars = Array.from(ratingContainer.querySelectorAll('.rating-star'));
        const ratingRadios = ratingContainer.querySelectorAll('input[type="radio"]');

        // Function to update the star colors based on a value
        function updateStars(value) {
            stars.forEach((star, index) => {
                const icon = star.querySelector('i.fas');
                if (icon) { // Add null check for icon
                    if (index < value) {
                        icon.style.color = '#ffc107'; // Use explicit color for selected
                    } else {
                        icon.style.color = '#ced4da'; // Use explicit color for unselected
                    }
                     // Remove conflicting Bootstrap classes if they exist
                    icon.classList.remove('text-warning', 'text-muted');
                }
            });
        }

        // Handle mouse hovering over stars
        stars.forEach((star, index) => {
            star.addEventListener('mouseenter', () => {
                // Temporarily show hover state colors up to the current star
                stars.forEach((s, i) => {
                    const icon = s.querySelector('i.fas');
                     if (icon) { // Add null check for icon
                        if (i <= index) { // Apply hover color up to the current star
                           icon.style.color = '#ffc107'; // Use explicit color for hover
                       } else { // Revert stars after the hovered one
                            const checkedRadio = ratingContainer.querySelector('input[type="radio"]:checked');
                            const currentValue = checkedRadio ? parseInt(checkedRadio.value) : 0;
                            if (i < currentValue) {
                                icon.style.color = '#ffc107'; // Keep previously selected color
                            } else {
                                icon.style.color = '#ced4da'; // Revert to light grey
                            }
                       }
                        // Remove conflicting Bootstrap classes if they exist
                       icon.classList.remove('text-warning', 'text-muted');
                    }
                });
            });
        });

        // When the mouse leaves the container, reset to the actual clicked value
        ratingContainer.addEventListener('mouseleave', () => {
            const checkedRadio = ratingContainer.querySelector('input[type="radio"]:checked');
            const currentValue = checkedRadio ? parseInt(checkedRadio.value) : 0;
            // Revert all stars to their state based on the checked radio
             stars.forEach((star, index) => {
                 const icon = star.querySelector('i.fas');
                 if (icon) { // Add null check for icon
                     if (index < currentValue) {
                         icon.style.color = '#ffc107';
                     } else {
                         icon.style.color = '#ced4da';
                     }
                      // Remove conflicting Bootstrap classes if they exist
                     icon.classList.remove('text-warning', 'text-muted');
                 }
             });
        });

        // When a star is clicked, set the radio button's value and update colors
        stars.forEach((star, index) => {
            star.addEventListener('click', () => {
                const radioToSelect = ratingRadios[index];
                radioToSelect.checked = true;
                // Update visual state immediately after click
                const clickedValue = parseInt(radioToSelect.value);
                 stars.forEach((s, i) => {
                      const icon = s.querySelector('i.fas');
                      if (icon) { // Add null check for icon
                          if (i < clickedValue) {
                              icon.style.color = '#ffc107'; // Apply color up to clicked star
                          } else {
                               icon.style.color = '#ced4da'; // Revert stars after clicked star
                          }
                           // Remove conflicting Bootstrap classes if they exist
                          icon.classList.remove('text-warning', 'text-muted');
                      }
                  });
            });
        });


        // Set the initial state from the database on page load using inline style
        const initialCheckedRadio = ratingContainer.querySelector('input[type="radio"]:checked');
        const initialValue = initialCheckedRadio ? parseInt(initialCheckedRadio.value) : 0;
         stars.forEach((star, index) => {
              const icon = star.querySelector('i.fas');
              if (icon) { // Add null check for icon
                  if (index < initialValue) {
                      icon.style.color = '#ffc107'; // Apply color based on initial value
                  } else {
                      icon.style.color = '#ced4da'; // Apply default grey
                  }
                   // Remove conflicting Bootstrap classes if they exist
                  icon.classList.remove('text-warning', 'text-muted');
              }
          });
    }
});
</script>
{# Closes block 'scripts' #}
{% endblock %}
